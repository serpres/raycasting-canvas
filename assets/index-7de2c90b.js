var g=Object.defineProperty;var M=(h,s,t)=>s in h?g(h,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[s]=t;var d=(h,s,t)=>(M(h,typeof s!="symbol"?s+"":s,t),t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(e){if(e.ep)return;e.ep=!0;const c=t(e);fetch(e.href,c)}})();class S{constructor(s){d(this,"el");d(this,"ctx");d(this,"colors");this.el=s,this.ctx=s.getContext("2d"),this.line=this.line.bind(this),this.circle=this.circle.bind(this),this.rect=this.rect.bind(this),this.clear=this.clear.bind(this),this.colors={grey:"#828282",blue:"#00bfff",yellow:"#fde910",orange:"#ff7433",dark:"#633327",light:"#884535",green:"#5da130"}}line({x1:s,y1:t,x2:i,y2:e,color:c}){this.ctx.beginPath(),this.ctx.moveTo(s,t),this.ctx.lineTo(i,e),this.ctx.strokeStyle=c,this.ctx.stroke(),this.ctx.closePath()}circle({x:s,y:t,r:i,color:e}){this.ctx.beginPath(),this.ctx.arc(s,t,i,0,2*Math.PI,!1),this.ctx.fillStyle=e,this.ctx.fill(),this.ctx.closePath()}rect({x:s,y:t,w:i,h:e,color:c}){this.ctx.beginPath(),this.ctx.fillStyle=c,this.ctx.fillRect(s,t,i,e),this.ctx.closePath()}clear(){this.ctx.clearRect(0,0,this.el.width,this.el.height)}}class u{static toRadians(s){return s*Math.PI/180}static calculateHypotenuse({x1:s,y1:t,x2:i,y2:e}){return Math.sqrt(Math.pow(i-s,2)+Math.pow(e-t,2))}}class w extends S{constructor(t){super(t);d(this,"cellSize");d(this,"map");d(this,"scene");d(this,"camera");this.scene=t,this.cellSize=64,this.map=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,0,0,0,1,1,1,0,0,0,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],this.camera={x:this.cellSize*2,y:this.cellSize*2,angle:0,speed:0,size:10,fieldOfView:u.toRadians(60)}}renderScene(t){t.forEach(({distance:i,vertical:e,angle:c},a)=>{i=i*Math.cos(c-this.camera.angle);const r=this.cellSize*5/i*277;this.rect({x:a,y:this.scene.height/2-r/2,w:1,h:r,color:e?this.colors.dark:this.colors.light}),this.rect({x:a,y:this.scene.height/2+r/2,w:1,h:this.scene.height/2-r/2,color:this.colors.green}),this.rect({x:a,y:0,w:1,h:this.scene.height/2-r/2,color:this.colors.blue})})}isOutOfMapBounds(t,i){return t<0||t>=this.map[0].length||i<0||i>=this.map.length}getHCollision(t){const i=Math.abs(Math.floor(t/Math.PI)%2),e=i?Math.floor(this.camera.y/this.cellSize)*this.cellSize:Math.floor(this.camera.y/this.cellSize)*this.cellSize+this.cellSize,c=this.camera.x+(e-this.camera.y)/Math.tan(t),a=i?-this.cellSize:this.cellSize,r=a/Math.tan(t);let n,l=c,o=e;for(;!n;){const m=Math.floor(l/this.cellSize),f=i?Math.floor(o/this.cellSize)-1:Math.floor(o/this.cellSize);if(this.isOutOfMapBounds(m,f))break;n=this.map[f][m],n||(l+=r,o+=a)}return{angle:t,distance:u.calculateHypotenuse({x1:this.camera.x,x2:l,y1:this.camera.y,y2:o}),vertical:!1}}getVCollision(t){const i=Math.abs(Math.floor((t-Math.PI/2)/Math.PI)%2),e=i?Math.floor(this.camera.x/this.cellSize)*this.cellSize+this.cellSize:Math.floor(this.camera.x/this.cellSize)*this.cellSize,c=this.camera.y+(e-this.camera.x)*Math.tan(t),a=i?this.cellSize:-this.cellSize,r=a*Math.tan(t);let n,l=e,o=c;for(;!n;){const m=i?Math.floor(l/this.cellSize):Math.floor(l/this.cellSize)-1,f=Math.floor(o/this.cellSize);if(this.isOutOfMapBounds(m,f))break;n=this.map[f][m],n||(l+=a,o+=r)}return{angle:t,distance:u.calculateHypotenuse({x1:this.camera.x,x2:l,y1:this.camera.y,y2:o}),vertical:!0}}castRay(t){const i=this.getVCollision(t),e=this.getHCollision(t);return e.distance>=i.distance?i:e}getRays(){const t=this.camera.angle-this.camera.fieldOfView/2,i=this.scene.width,e=this.camera.fieldOfView/i;return Array.from({length:i},(c,a)=>{const r=t+a*e;return this.castRay(r)})}renderMinimap({posX:t=0,posY:i=0,scale:e=1,rays:c}){const a=e*this.cellSize;this.map.forEach((r,n)=>{r.forEach((l,o)=>{l&&this.rect({x:t+o*a,y:i+n*a,w:a,h:a,color:this.colors.grey})})}),c.forEach(r=>{this.line({x1:this.camera.x*e+t,y1:this.camera.y*e+i,x2:(this.camera.x+Math.cos(r.angle)*r.distance)*e+t,y2:(this.camera.y+Math.sin(r.angle)*r.distance)*e+i,color:this.colors.yellow})}),this.circle({x:t+this.camera.x*e,y:i+this.camera.y*e,r:this.camera.size/2,color:this.colors.orange})}setCameraMove(t,i){(t==="w"||t==="ArrowUp")&&(i==="keydown"?this.camera.speed=2:this.camera.speed=0),(t==="s"||t==="ArrowDown")&&(i==="keydown"?this.camera.speed=-2:this.camera.speed=0)}cameraMove(){this.camera.x+=Math.cos(this.camera.angle)*this.camera.speed,this.camera.y+=Math.sin(this.camera.angle)*this.camera.speed}cameraRotation(t){this.camera.angle+=u.toRadians(t)}render(){this.clear();const t=this.getRays();this.cameraMove(),this.renderScene(t),this.renderMinimap({posX:10,posY:30,scale:.3,rays:t})}exec(){this.render(),requestAnimationFrame(this.exec.bind(this))}}const y=document.createElement("canvas");y.width=window.innerWidth;y.height=window.innerHeight;const x=new w(y);x.exec();document.addEventListener("keydown",({key:h})=>{x.setCameraMove(h,"keydown")});document.addEventListener("keyup",({key:h})=>{x.setCameraMove(h,"keyup")});document.addEventListener("mousemove",({movementX:h})=>{x.cameraRotation(h)});const p=document.getElementById("app");p==null||p.appendChild(y);
